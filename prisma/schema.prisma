generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Jobs found by AI - the feed
model Job {
  id          String   @id @default(cuid())
  title       String
  company     String
  companyLogo String?
  location    String?
  type        JobType  @default(FULL_TIME)
  salary      String?
  description String   @db.Text
  url         String   // Removed unique constraint to avoid migration issues
  source      String?  // Where the job was found
  postedAt    DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Tracking relationship
  tracking    TrackedJob?

  @@index([url]) // Index for faster lookups
}

enum JobType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERNSHIP
  FREELANCE
  REMOTE
}

// Jobs being tracked by user
model TrackedJob {
  id        String      @id @default(cuid())
  jobId     String      @unique
  job       Job         @relation(fields: [jobId], references: [id], onDelete: Cascade)
  status    JobStatus   @default(SAVED)
  notes     String?     @db.Text
  appliedAt DateTime?
  updatedAt DateTime    @updatedAt
  createdAt DateTime    @default(now())
}

enum JobStatus {
  SAVED
  APPLIED
  INTERVIEW
  OFFER
  ACCEPTED
  REJECTED
  WITHDRAWN
}

// User settings/preferences for AI
model Settings {
  id                String   @id @default("user-settings")
  
  // Job preferences
  desiredRoles      String?  @db.Text
  preferredLocations String? @db.Text
  remotePreference  String?  @db.Text
  salaryExpectation String?  @db.Text
  
  // Background
  skills            String?  @db.Text
  experience        String?  @db.Text
  education         String?  @db.Text
  
  // Preferences
  industries        String?  @db.Text
  companySize       String?  @db.Text
  dealBreakers      String?  @db.Text
  
  // Open-ended
  additionalNotes   String?  @db.Text
  
  // Custom scraping sources
  scrapeUrls        String?  @db.Text
  
  updatedAt         DateTime @updatedAt
  createdAt         DateTime @default(now())
}

// Search history/log for AI jobs
model SearchLog {
  id          String   @id @default(cuid())
  query       String   @db.Text
  jobsFound   Int      @default(0)
  searchedAt  DateTime @default(now())
}
